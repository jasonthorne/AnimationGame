<!DOCTYPE html>

<html>
  <head>
    <meta charset="UTF-8">
    <title>Apple Catch</title>
    <style type="text/css">
	
		#timerCounterDiv{
			width: auto;
			height: auto;
			position: absolute;
			left: 73px;
			top: 50px;
		}
    
		#hitsCounterDiv {
			width: auto;
			height: auto;
			position: absolute;
			left: 75px; 
			top: 50px; 
		}    
			
		#span{
			position: absolute;
			right: 20px;
			top: 20px;
		}
    
    </style>
  </head>
  <body>
  
		<div id="timerCounterDiv">
           <span id="timer"></span> <!--shows timer-->
        </div>
  
        <div id="hitsCounterDiv">
            <span id="hits"></span> <!--shows hits-->
        </div>
		
		<canvas id="canvas" width="873" height="640"></canvas> 
        <script type="text/javascript">
			
			//create canvas:
			var canvas = document.getElementById("canvas"),
			ctx = canvas.getContext("2d");
			
			//background vars: 
			var background = new Image(); //background image
			background.src = 'img/bg.png'; //image source
			var backgroundX  = 0 //x pos of background 
			var backgroundY  = 0; //y pos of background 
			var backgroundW  = canvas.width; //width of background 
			var backgroundH  = canvas.height; //height of background 
			
			//basket vars:
			var basket = new Image(); //basket image
			var basketW = 100; //width of basket
			var basketH = 100; //height of basket
			var basketX = (canvas.width - basketW) /2; //x pos of basket 
			var basketY = (canvas.height - basketH) - 10; //y pos of basket 
			var basketObj = null;  //basket object
			
			//apple vars:
			var apple = new Image(); //apple image
			apple.src = 'img/apl.png'; //image source
			var MAX_APLS = 2; //////////////10; //amount of apples
			var applesArray = [MAX_APLS]; //array for apples 
			//var canDrop = [MAX_APLS]; //holds which apples can drop
			var appleX = [50, 100]; //50; //[50, 100, 100, 200, 220, 260, 350, 400, 450, 300]; //holds x pos of apples    
			var appleY = [280, 200]; //280; //[280, 200, 100, 20, 150, 60, 120, 140, 240, 20]; //holds y pos of apples     
			var appleW = 60; //width of apple
			var appleH = 60; //height of apple
			////////////////////////var appleObj = null; //apple object
			
			//var randY = 0; //holds random y pos //+++++++++++++ 
			
			var i = 0; //for loops 
			var hits = 0; //hit counter
            var key = []; //for keycode values   
			
			//game timer: ////////////////////////////CAN PROBABLY BE LOCAL +++++++++++++++++++++
			var time = 0; //time
			var timer = null; //counter
			
			//==========================================
			var randNum;
			
			//+++++++++++++++++++
				function appleObj(xPos, yPos){
					this.xPos = xPos;
					this.yPos = yPos;
					this.width = appleW;
					this.height = appleH;
					this.waitToFall = function(){
						console.log("hi");
						//randNum = Math.floor(Math.random() * (3000 - 9000)) + 1000; //between 1 - 4 seconds
						//console.log(randNum);
						
						//return randNum; ///+++++++++++
						this.fall();
						/*
						ctx.drawImage(apple, apls[i].xPos, apls[i].yPos, apls[i].width, apls[i].height); 
            
						 setTimeout(function(){
						 
						 console.log("there");
							 	///appleObj.yPos += 15;
								apls[i].fall(); //++++++++++++++++++++
								
						 },randNum);*/
						 
					};
					this.fall = function falling(){
						this.yPos += 15;
												console.log("yo");
						//ctx.drawImage(apple, this.xPos, this.yPos, this.width, this.height); 
						ctx.clearRect(0, 0, canvas.width, canvas.height); //clear canvas
					ctx.drawImage(background, backgroundX, backgroundY, backgroundW, backgroundH); //draw background
					ctx.drawImage(apple, this.xPos, this.yPos, this.width, this.height); ///???????
						
						requestAnimationFrame(falling);
					};
					
					
					this.waitToFall();
					
					
				}
				
				/*
				var testArray = [];
				var testApple = new appleObj(4, 5);
				testArray.push(testApple)
				testApple.waitToFall();
				testArray[0].waitToFall();
				*/
				
				//++++++++++++++++++++
			
			//=========================================
			
			//styles for hits:
			document.getElementById("hits").style.fontSize = "x-large"; //font size
			document.getElementById("hits").style.fontFamily = "Comic Sans MS"; //font family
			
			//styles for timer
			document.getElementById("timer").style.fontSize = "x-large"; //font size
			document.getElementById("timer").style.fontFamily = "Comic Sans MS"; //font family
			
			//onload events:
			background.onload = function(){
				ctx.drawImage(background, backgroundX, backgroundY, backgroundW, backgroundH); //draw background
				
				//basket image source (assigned here so that background is drawn first)
				basket.src = 'img/bsk.png'; 
				
				//load and draw basket:
				basket.onload = function(){
					ctx.drawImage(basket, basketX, basketY, basketW, basketH);    
				}
				
			}
			
			
			//key event listeners:
			window.addEventListener("keydown", function(event){ //listens for key press, adds its keycode 
				key[event.keyCode] = true; 
			});
	   
		    window.addEventListener("keyup", function(event){ //listens for key release, removes its keycode
				key[event.keyCode] = false;
		    });
			
			
			//*********************************GAME IS STARTED HERE************************************
			innit(); //initialise variables
			//playGame(); //play game
			//****************************************************************************************

			//initialise variables:
			function innit(){
				
				//hits = 0; //set hit counter 
				time = 16; //set time
				timer = setInterval(runTimer, 1000); //run timer
				//document.getElementById("hits").innerHTML = hits; //set value of hits 
				//document.getElementById("timer").innerHTML = "Ready!?"; //set start message //++++++++++++++++++++++++++
				document.getElementById("timer").innerHTML = time; // + " secs"; //set start message //++++++++++++++++++++++++++
				////randY = 0; //set y pos*/
				
				//set basket:
				basketObj = {
					xPos: basketX,
					yPos: basketY,
					width: basketW,
					height: basketH,
					move: function(){
					
						if (key[37]){ //if left is pressed
							basketObj.xPos -=30; //decrease x pos
							
							if(basketObj.xPos <0){ //check for canvas collision
								basketObj.xPos = 0; //stop at screen edge
							}
						}else if (key[39]){ //if right is pressed
							basketObj.xPos += 30; //increase x pos
					
							if(basketObj.xPos > (canvas.width - basketObj.width)){ //check for canvas collision
								basketObj.xPos = canvas.width - basketObj.width; //stop at screen edge
							}
						}
						
						ctx.drawImage(basket, basketObj.xPos, basketObj.yPos, basketObj.width, basketObj.height); //draw basket 
					}
				};
				
				
				//=====================================
				for (i=0; i<MAX_APLS; i++){
					applesArray.push(new appleObj(appleX[i], appleY[i]));
					//console.log(applesArray[i]);
				
				}
				
				//applesArray[0].waitToFall();
				
				/*
				for (i=0; i<MAX_APLS; i++){
					
					console.log(applesArray[i].waitToFall());
					
					var test = applesArray[i];
					
					console.log(test); //////////????????????
					est = applesArray[i];
					
					for (var key in test){ //go through each key in student
						console.log(test[key]); //print the key values
					}
				
				}*/
				
				
				
				/*
				for (i=0; i<MAX_APLS; i++){
				
					apls[i] = {
					xPos: appleX,
					yPos: appleY,
					width: appleW,
					height: appleH,
					waitToFall: function(){
					
					console.log("hi");
						randNum = Math.floor(Math.random() * (3000 - 9000)) + 1000; //between 1 - 4 seconds
						console.log(randNum);
						
						ctx.drawImage(apple, apls[i].xPos, apls[i].yPos, apls[i].width, apls[i].height); 
            
						 setTimeout(function(){
						 
						 console.log("there");
							 	///appleObj.yPos += 15;
								apls[i].fall(); //++++++++++++++++++++
								
						 },randNum);
						 
					},
					
					fall: function falling(){
						apls[i].yPos += 15;
						
						ctx.drawImage(apple, apls[i].xPos, apls[i].yPos, apls[i].width, apls[i].height); 
						
						requestAnimationFrame(falling);
					}
				};
				
				apls[i].waitToFall();
				
				}*/
				
				
				/*
				appleObj = {
					xPos: appleX,
					yPos: appleY,
					width: appleW,
					height: appleH,
					waitToFall: function(){
					
					console.log("hi");
						randNum = Math.floor(Math.random() * (3000 - 9000)) + 1000; //between 1 - 4 seconds
						console.log(randNum);
						
						ctx.drawImage(apple, appleObj.xPos, appleObj.yPos, appleObj.width, appleObj.height); 
            
						 setTimeout(function(){
						 
						 console.log("there");
							 	///appleObj.yPos += 15;
								appleObj.fall();
								

						 },randNum);
						 
					},
					
					fall: function falling(){
						appleObj.yPos += 15;
						
						ctx.drawImage(apple, appleObj.xPos, appleObj.yPos, appleObj.width, appleObj.height); 
						
						requestAnimationFrame(falling);
					}
				};
				
				appleObj.waitToFall();
				*/
				
			
				//each apple has a timer, which is fired upon apple creation
				//when timer is reached, it calls its own drop method, with a random time.
				//drop method checks if apple has hit basket or floor;
				//resets itself if hit either, and starts a new timer
				//=====================================
				
				
				
				//https://stackoverflow.com/questions/30578195/how-to-make-multiple-balls-drop-on-click	+++++++++++++++++++++++++	
				
				animate(); //animate game
			}

			
			
			function animate(){
			
				ctx.clearRect(0, 0, canvas.width, canvas.height); //clear canvas
				ctx.drawImage(background, backgroundX, backgroundY, backgroundW, backgroundH); //draw background
					
				//=============================================
				//////////////////////////////ctx.drawImage(apple, appleObj.xPos, appleObj.yPos, appleObj.width, appleObj.height); 
				//appleObj.waitToFall();
				//=============================================
				 
				
				basketObj.move(); //moveBasket();
				
				
				
				requestAnimationFrame(animate); //game continues
				
			}
			
			//timer
			function runTimer(){
			
				time--; //reduce timer
				
				if (time < 0){ //check if timer ended
					clearInterval(timer); //clear interval
					//gameEnd(); //end game  //+++++++++++++++++++++++++
					//innit(); //+++++++++++++++++++REMOVE LATER!!
					
				}
				
				document.getElementById("timer").innerHTML = time; //update time
			}
			
			
			
			/*
			function draw(){ //draws to canvas
				
			   ctx.clearRect(0, 0, canvas.width, canvas.height); //clear canvas
			   ctx.drawImage(background, backgroundX, backgroundY, backgroundW, backgroundH); //draw background 
			  
			  /*
			   for(i=0; i<MAX_APLS; i++) //draw apples
			   {
				   ctx.drawImage(apl, apls[i].xPos, apls[i].yPos, apls[i].wdth, apls[i].hght); 
			   }*/
				/*
				moveBasket(); ///////////////////////
				
				
				
				//clearCanvas(); //clear canvas
				//ctx.drawImage(basket, basketObj.xPos, basketObj.yPos, basketObj.width, basketObj.hight); //draw basket 
					
			
				
			    ctx.drawImage(basket, basketObj.xPos, basketObj.yPos, basketObj.width, basketObj.hight); //draw basket 
					
			}*/
		
			
		</script>
		
		
		
  </body>
</html>