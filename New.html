<!DOCTYPE html>

<html>
  <head>
    <meta charset="UTF-8">
    <title>Apple Catch</title>
    <style type="text/css">
	
		#timerCounterDiv{
			width: auto;
			height: auto;
			position: absolute;
			left: 73px;
			top: 50px;
		}
    
		#hitsCounterDiv {
			width: auto;
			height: auto;
			position: absolute;
			left: 75px; 
			top: 50px; 
		}    
			
		#span{
			position: absolute;
			right: 20px;
			top: 20px;
		}
    
    </style>
  </head>
  <body>
  
		<div id="timerCounterDiv">
           <span id="timer"></span> <!--shows timer-->
        </div>
  
        <div id="hitsCounterDiv">
            <span id="hits"></span> <!--shows hits-->
        </div>
		
	<canvas id="canvas" width="873" height="640"></canvas> 
        <script type="text/javascript">
			
			//create canvas:
			var canvas = document.getElementById("canvas"),
			ctx = canvas.getContext("2d");
			
			//background vars: 
			var background = new Image(); //background image
			background.src = 'img/bg.png'; //image source
			var backgroundX  = 0 //x pos of background 
			var backgroundY  = 0; //y pos of background 
			var backgroundW  = canvas.width; //width of background 
			var backgroundH  = canvas.height; //height of background 
			
			//basket vars:
			var basket = new Image(); //basket image
			var basketW = 100; //width of basket
			var basketH = 100; //height of basket
			var basketX = (canvas.width - basketW) /2; //x pos of basket 
			var basketY = (canvas.height - basketH) - 10; //y pos of basket 
			var basketObj = null;  //basket object
			
			//apple vars:
			var apple = new Image(); //apple image
			apple.src = 'img/apl.png'; //image source
			//var MAX_APLS = 10; //amount of apples
			//var apls = [MAX_APLS]; //array for apples 
			//var canDrop = [MAX_APLS]; //holds which apples can drop
			var appleX = 50; //[50, 100, 100, 200, 220, 260, 350, 400, 450, 300]; //holds x pos of apples    
			var appleY = 280; //[280, 200, 100, 20, 150, 60, 120, 140, 240, 20]; //holds y pos of apples     
			var appleW = 60; //width of apple
			var appleH = 60; //height of apple
			var appleObj = null; //apple object
			
			
			//var randY = 0; //holds random y pos //+++++++++++++ 
			
			let apples = new Map();
			
			
			var i = 0; //for loops 
			var hits = 0; //hit counter
            var key = []; //for keycode values   
			
			//game timer:
			var time = 0; //time
			var timer = null; //counter
			
			//styles for hits:
			document.getElementById("hits").style.fontSize = "x-large"; //font size
			document.getElementById("hits").style.fontFamily = "Comic Sans MS"; //font family
			
			//styles for timer
			document.getElementById("timer").style.fontSize = "x-large"; //font size
			document.getElementById("timer").style.fontFamily = "Comic Sans MS"; //font family
			
			//animation frame:	
			(function (){
			var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
			window.requestAnimationFrame = requestAnimationFrame;
			})();
	
			//onload events:
			background.onload = function(){
				ctx.drawImage(background, backgroundX, backgroundY, backgroundW, backgroundH); //draw background
				
				//basket image source (assigned here so that background is drawn first)
				basket.src = 'img/bsk.png'; 
				
				//load and draw basket:
				basket.onload = function(){
					ctx.drawImage(basket, basketX, basketY, basketW, basketH);    
				}
				
			}
			
			//event listeners:
			window.addEventListener("keydown", function(event){ //listens for key press, adds its keycode 
				key[event.keyCode] = true; 		
			});
	   
		    window.addEventListener("keyup", function(e){ //listens for key release, removes its keycode
				key[e.keyCode] = false;
		    });
			
			
			//*********************************GAME IS STARTED HERE************************************
			innit(); //initialise variables
			playGame(); //play game
			//****************************************************************************************

			//initialise variables:
			function innit(){
				
				
				//hits = 0; //set hit counter 
				time = 16; //set time
				timer = setInterval(runTimer, 1000); //run timer
				//document.getElementById("hits").innerHTML = hits; //set value of hits 
				//document.getElementById("timer").innerHTML = "Ready!?"; //set start message //++++++++++++++++++++++++++
				document.getElementById("timer").innerHTML = time; // + " secs"; //set start message //++++++++++++++++++++++++++
				////randY = 0; //set y pos*/
				
				//set basket:
				basketObj = {
					xPos: basketX,
					yPos: basketY,
					width: basketW,
					hight: basketH       
				};
				
				//https://stackoverflow.com/questions/30578195/how-to-make-multiple-balls-drop-on-click
				
			} 
			
			function playGame(){
			
				
				//makeApple(); //=======================+++++++++++++++++++++++
					
				//draw();
				
				//waitToPick(); //apples wait to be picked

				//dropApl(); //apples are dropped
				
				moveBasket(); //basket moved on keypress
				
				//draw(); //canvas redrawn

				requestAnimationFrame(playGame); //game continues
				
			}
			
			//timer
			function runTimer(){
			
				time--; //reduce timer
				
				document.getElementById("timer").innerHTML = time; //update time
				
				if (time <= 0){ //check if timer ended
					clearInterval(time); //clear interval
					//gameEnd(); //end game  //+++++++++++++++++++++++++
					innit(); //+++++++++++++++++++REMOVE LATER!!
				}
			}
			
			
			function draw() { //draws to canvas
				  
			   ctx.clearRect(0, 0, canvas.width, canvas.height); //clear canvas
			   
			   ctx.drawImage(background, backgroundX, backgroundY, backgroundW, backgroundH); //draw background 
			  
			  /*
			   for(i=0; i<MAX_APLS; i++) //draw apples
			   {
				   ctx.drawImage(apl, apls[i].xPos, apls[i].yPos, apls[i].wdth, apls[i].hght); 
			   }*/
				
			   ctx.drawImage(basket, basketObj.xPos, basketObj.yPos, basketObj.width, basketObj.hight); //draw basket 
					
			}

			
			//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++888888888888888888888888888888888
			function clearCanvas() { //clears canvas, and redraws background
				  
			   ctx.clearRect(0, 0, canvas.width, canvas.height); //clear canvas
			   ctx.drawImage(background, backgroundX, backgroundY, backgroundW, backgroundH); //redraw background 
			 
			}
			//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++888888888888888888888888888888888			
			
			
			function moveBasket(){ //move basket according to user's key press
			
				if (key[37]){ //if left is pressed

					basketObj.xPos -=30;
					
					if(basketObj.xPos <0){ //check for canvas collision
						basketObj.xPos = 0; //stop at screen edge
					}
				}
				else if (key[39]){ //if right is pressed
				
				   //bskObj.xPos += 20; //increase x pos
				   basketObj.xPos += 30; //increase x pos
					
					if(basketObj.xPos > (canvas.width - basketObj.width)){ //check for canvas collision
						basketObj.xPos = canvas.width - basketObj.width; //stop at screen edge
					}
				}
			
				clearCanvas(); //clear canvas
				ctx.drawImage(basket, basketObj.xPos, basketObj.yPos, basketObj.width, basketObj.hight); //draw basket 
					
			} 
			
			
			/*
			function makeApple(){ //+++++++++++++++++++++++++++++++++++
			
				appleObj = {
					xPos: appleX,
                    yPos: appleY,
                    width: appleW,
                    hight: appleH  
				};	
			}*/
			
			/*
			function draw(){ //+++++++++++++++++++++++++++++++++++
			
				ctx.drawImage(apple, appleObj.xPos, appleObj.yPos, appleObj.width, appleObj.hight);
			
			}*/
			
			
			
			
		</script>
		
		
		
  </body>
</html>