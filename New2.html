<!DOCTYPE html>

<html>
  <head>
    <meta charset="UTF-8">
    <title>Apple Catch</title>
    <style type="text/css">
	
		#timerCounterDiv{
			width: auto;
			height: auto;
			position: absolute;
			left: 73px;
			top: 50px;
		}
    
		#hitsCounterDiv {
			width: auto;
			height: auto;
			position: absolute;
			left: 424px; 
			top: 412px; 
		}    
			
		#span{
			position: absolute;
			right: 20px;
			top: 20px;
		}
    
    </style>
  </head>
  <body>
  
		<div id="timerCounterDiv">
           <span id="timer"></span> <!--shows timer-->
        </div>
  
        <div id="hitsCounterDiv">
            <span id="hits"></span> <!--shows hits-->
        </div>
		
		<canvas id="canvas" width="873" height="640"></canvas> 
        <script type="text/javascript">
			
			//create canvas:
			var canvas = document.getElementById("canvas"),
			ctx = canvas.getContext("2d");
			
			//background vars: 
			var backgroundImg = new Image(); //background image
			backgroundImg.src = 'img/bg.png'; //image source
			var backgroundX  = 0; //x pos of background 
			var backgroundY  = 0; //y pos of background 
			var backgroundW  = canvas.width; //width of background 
			var backgroundH  = canvas.height; //height of background 
			
			//basket vars:
			var basketImg = new Image(); //basket image
			var basketW = 100; //width of basket
			var basketH = 100; //height of basket
			var basketX = (canvas.width - basketW) /2; //x pos of basket 
			var basketY = (canvas.height - basketH) - 10; //y pos of basket 
			//var Basket = null;  //basket object //+++++++++++++++++++++++++++++++++can maybe go!
			
			//apple vars:
			var appleImg = new Image(); //apple image
			appleImg.src = 'img/apl.png'; //image source
			var MAX_APLS = 1; //amount of apples
			var applesArray = []; //array for apples 
			//var canDrop = [MAX_APLS]; //holds which apples can drop
			var appleX = [50, 130, 200, 260, 350, 450, 600, 610, 550, 750]; //holds x pos of apples  
			var appleY = [180, 100, 180, 80, 150, 220, 40, 150, 240, 200]; //holds y pos of apples   
			var appleW = 60; //width of apple
			var appleH = 60; //height of apple
			var appleSpeedsArray = [3, 6, 12]; //hold apple drop speeds
			////////////////////////var Apple = null; //apple object
			
			//var randY = 0; //holds random y pos //+++++++++++++ 
			
			var i = 0; //for loops 
			var hits = 0; //hit counter
            var key = []; //for keycode values   
			//var key = 0; //+++++++++++++ 
			//game timer: ////////////////////////////CAN PROBABLY BE LOCAL +++++++++++++++++++++
			var time = 0; //time
			//var timer;  ///////////////= null; //counter
			
			//==========================================
			var test;//////////DELETE LATER!
			//++++++++++++++++++++
			
			var testPic1 = new Image();
			testPic1.src = 'img/apl1.png';
			var testPic2 = new Image();
			testPic2.src = 'img/apl2.png';
			var testPic3 = new Image();
			testPic3.src = 'img/apl3.png';
			var testPic4 = new Image();
			testPic4.src = 'img/apl4.png';
			var testPic5 = new Image();
			testPic5.src = 'img/apl5.png';
			var testPic6 = new Image();
			testPic6.src = 'img/apl6.png';
			var testPic7 = new Image();
			testPic7.src = 'img/apl7.png';
			var testPic8 = new Image();
			testPic8.src = 'img/apl8.png';
			var testPic9 = new Image();
			testPic9.src = 'img/apl9.png';
			var testPic10 = new Image();
			testPic10.src = 'img/apl10.png';
			
			var testPicsArray = [testPic1, testPic2, testPic3, testPic4, testPic5, testPic6, testPic7, testPic8, testPic9, testPic10];
			
			//+++++++++++++++++++
			
			//styles for hits:
			document.getElementById("hits").style.fontSize = "x-large"; //font size
			document.getElementById("hits").style.fontFamily = "Comic Sans MS"; //font family
			
			//styles for timer
			document.getElementById("timer").style.fontSize = "x-large"; //font size
			document.getElementById("timer").style.fontFamily = "Comic Sans MS"; //font family
			
			//onload events:
			backgroundImg.onload = function(){
				ctx.drawImage(backgroundImg, backgroundX, backgroundY, backgroundW, backgroundH); //draw background
				
				//basket image source (assigned here so that background is drawn first)
				basketImg.src = 'img/bsk.png'; 
				
				//load and draw basket:
				basketImg.onload = function(){
					ctx.drawImage(basketImg, basketX, basketY, basketW, basketH);    
				}
				
			}
			
			
			//key event listeners:
			window.addEventListener("keydown", function(event){ //listens for key press, adds its keycode 
				key[event.keyCode] = true; 
				///////////key = event.keyCode; ++++++++++++++++++++++
			});
	   
		    window.addEventListener("keyup", function(event){ //listens for key release, removes its keycode
				key[event.keyCode] = false;
				//////////key = 0; ++++++++++++++++++++++
		    });
			
			//=========================================
			//prototype method added to Array class, to allow random picking of elements:
			Array.prototype.pickElement = function(){ 
				return this[Math.floor(Math.random()*this.length)]; //return a random element
			}//https://stackoverflow.com/questions/4550505/getting-a-random-value-from-a-javascript-array
			
			
			
			function Apple(xPos, yPos){
				this.canDrop = true; //+++++++++++++
				this.xPos = xPos;
				this.yPos = yPos;
				this.width = appleW;
				this.height = appleH;
				this.speed = appleSpeedsArray.pickElement(); //pick a speed for apple to drop by
				this.reset = function(){
					this.yPos = yPos; //reset y position
					this.speed = appleSpeedsArray.pickElement(); //assign a new random speed
					
					
					//console.log("$$$$$$$$$$$$$$$$$$"); 
					this.canDrop = false;
					
					setTimeout(function(){
					console.log("$$$$$$$$$$$$$$$$$$"); 
					this.canDrop = true;
					console.log(canDrop); 
					///this.fall();
					}, 3000);
					
					
				};
				this.fall = function(){
					console.log("willie"); 
					/*
					(setTimeout(function(){
					console.log("Hello"); 
					//this.fall();
					}, 3000));
					*/
					
						this.yPos += this.speed; //drop apple
						
						if(hitApple(this, Basket)){ //check if apple hit basket
							hits++; //add to hit counter
							document.getElementById("hits").innerHTML = hits; //update hit counter
							//this.canDrop = false; //+++++++++++++++
							this.reset(); //reset apple
						}
						
						if(this.yPos >= (canvas.height - this.height)){ //check if apple has hit bottom of canvas
							//this.canDrop = false; //+++++++++++++++
							this.reset(); //reset apple
							
						}
					
				
				};
				//this.prep = setInterval(runTimer, apleTimer);
				this.prep = function(){setInterval(function(){
					//alert("Hello");
					console.log("Hello"); 
					//this.fall();
				}, 3000) //clearInterval(this.prep)
				
				};
				
				
				
			}
			
			//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
			/*
			function Basket(){
					this.xPos = basketX;
					this.yPos = basketY;
					this.width = basketW;
					this.height = basketH;
					this.move = function(){
						if (key[37]){ //if left is pressed
							this.xPos -=30; //decrease x pos
							
							if(this.xPos <0){ //check for canvas collision
								this.xPos = 0; //stop at screen edge
							}
						}else if (key[39]){ //if right is pressed
							this.xPos += 30; //increase x pos
					
							if(this.xPos > (canvas.width - this.width)){ //check for canvas collision
								this.xPos = canvas.width - this.width; //stop at screen edge
							}
						}//else: pause game and remind user of key controls //+++++++++++++++++++++++++++++DONT FORGET THIS!!!! 
						ctx.drawImage(basketImg, this.xPos, this.yPos, this.width, this.height); //draw basket 
					};
			}*/
			
			
			//=========================================
			
			
			//*********************************GAME IS STARTED HERE************************************
			innit(); //initialise variables
			//playGame(); //play game
			//****************************************************************************************

			//initialise the game:
			function innit(){
				
				hits = 0; //set hit counter 
				time = 16; //set time
				////timer = setInterval(new Timer(), 1000); //run timer
				var timer = setInterval(runTimer, 1000); //run timer
				document.getElementById("timer").innerHTML = time; //set timer element
				document.getElementById("hits").innerHTML = hits; //set hits element
				////randY = 0; //set y pos*/
				
				
				//set basket:
				Basket = {
					xPos: basketX,
					yPos: basketY,
					width: basketW,
					height: basketH,
					move: function(){
						if (key[37]){ //if left is pressed
							Basket.xPos -=30; //decrease x pos
							
							if(Basket.xPos <0){ //check for canvas collision
								Basket.xPos = 0; //stop at screen edge
							}
						}else if (key[39]){ //if right is pressed
							Basket.xPos += 30; //increase x pos
					
							if(Basket.xPos > (canvas.width - Basket.width)){ //check for canvas collision
								Basket.xPos = canvas.width - Basket.width; //stop at screen edge
							}
						}//else: pause game and remind user of key controls //+++++++++++++++++++++++++++++DONT FORGET THIS!!!! 
						
						/*
						switch(key) {
							
							case key[37]: //left key was pressed
								console.log("left pressed");
								
								Basket.xPos -=30; //decrease x pos
							
								if(Basket.xPos <0){ //check for canvas collision
									Basket.xPos = 0; //stop at screen edge
								}
								break;
							case key[39]: //right key was pressed
								console.log("right pressed");
								
								Basket.xPos += 30; //increase x pos
					
								if(Basket.xPos > (canvas.width - Basket.width)){ //check for canvas collision
									Basket.xPos = canvas.width - Basket.width; //stop at screen edge
								}
							
							break;
							case 0: //no key currently pressed
								console.log("no key");
								break;
							default: //any other key was pressed
								console.log("another key");
						}*/
						
						//console.log(key);
						
						ctx.drawImage(basketImg, Basket.xPos, Basket.yPos, Basket.width, Basket.height); //draw basket 
					}
				};
				
				
				//create and store Apples:
				for (i=0; i<MAX_APLS; i++){
				
				
				
				//FIRE OFF TIMER HERE!!!!!!!!!!!!!!!!!!!!!!!!! then push created object into array. 
					applesArray.push(new Apple(appleX[i], appleY[i], 1000)); //add Apple to array 
				}
				
			
				//each apple has a timer, which is fired upon apple creation
				//https://www.w3schools.com/jsref/met_win_settimeout.asp
				//when timer is reached, it calls its own drop method, with a random time.
				//drop method checks if apple has hit basket or floor;
				//resets itself if hit either, and starts a new timer
				//=====================================
				
				
				
				//https://stackoverflow.com/questions/30578195/how-to-make-multiple-balls-drop-on-click	+++++++++++++++++++++++++	
				
				animate(); //animate game
			}
			
			
			
			//animate game:
			function animate(){
			
				ctx.clearRect(0, 0, canvas.width, canvas.height); //clear canvas
				ctx.drawImage(backgroundImg, backgroundX, backgroundY, backgroundW, backgroundH); //draw background
					
				//=============================================
				//for (var i=0, AppleI; AppleI=applesArray[i]; i++){ //grab each Apple in array
				for (var i=0; i< MAX_APLS; i++){
					//applesArray.push(new Apple(appleX[i], appleY[i])); //add Apple to array 
					//applesArray[i].fall(); //invoke fall
					///console.log("bum");
					console.log("hmmmmm: " + applesArray[i].canDrop);
					if (applesArray[i].canDrop){
						applesArray[i].fall(); //invoke fall
					}
					
					//applesArray[i].prepApple();
					ctx.drawImage(testPicsArray[i], applesArray[i].xPos, applesArray[i].yPos, applesArray[i].width, applesArray[i].height); //draw Apple
					//ctx.drawImage(appleImg, AppleI.xPos, AppleI.yPos, AppleI.width, AppleI.height); //draw Apple
					//ctx.drawImage(testPicsArray[i], AppleI.xPos, AppleI.yPos, AppleI.width, AppleI.height); //draw Apple

				}	
				
				//=============================================
				
				Basket.move(); //move basket
				
			
				requestAnimationFrame(animate); //game continues
				
			}
			
			
			//game timer:
			function runTimer(){
			
				time--; //reduce timer
				console.log(time);
				
				if (time <=0){ //check if timer ended
					clearInterval(timer); //clear interval
					//gameEnd(); //end game  //+++++++++++++++++++++++++
					//innit(); //+++++++++++++++++++REMOVE LATER!!
					
				}
				
				document.getElementById("timer").innerHTML = time; //update time
			}
			
			/*
			function Timer(time){
				console.log("Yo");
				this.time--; //reduce timer
				
				if (this.time <=0){ //check if timer ended
					clearInterval(timer); //clear interval
					//gameEnd(); //end game  //+++++++++++++++++++++++++
					//innit(); //+++++++++++++++++++REMOVE LATER!!
					
				}
				
				document.getElementById("timer").innerHTML = this.time; //update time
			}*/
			
			//check for collision:
			function hitApple(Apple,Basket){ 
				 return Apple.xPos < Basket.xPos + Basket.width && //return if apple has hit basket
				 Apple.xPos + Apple.width > Basket.xPos &&
				 Apple.yPos < Basket.yPos + Basket.height &&
				 Apple.yPos + Apple.height > Basket.yPos;
			}
			
		</script>
		
		
		
  </body>
</html>