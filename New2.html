<!DOCTYPE html>

<html>
  <head>
    <meta charset="UTF-8">
    <title>Apple Catch</title>
    <style type="text/css">
	
		#timerCounterDiv{
			width: auto;
			height: auto;
			position: absolute;
			left: 73px;
			top: 50px;
		}
    
		#hitsCounterDiv {
			width: auto;
			height: auto;
			position: absolute;
			left: 75px; 
			top: 50px; 
		}    
			
		#span{
			position: absolute;
			right: 20px;
			top: 20px;
		}
    
    </style>
  </head>
  <body>
  
		<div id="timerCounterDiv">
           <span id="timer"></span> <!--shows timer-->
        </div>
  
        <div id="hitsCounterDiv">
            <span id="hits"></span> <!--shows hits-->
        </div>
		
		<canvas id="canvas" width="873" height="640"></canvas> 
        <script type="text/javascript">
			
			//create canvas:
			var canvas = document.getElementById("canvas"),
			ctx = canvas.getContext("2d");
			
			//background vars: 
			var backgroundImg = new Image(); //background image
			backgroundImg.src = 'img/bg.png'; //image source
			var backgroundX  = 0 //x pos of background 
			var backgroundY  = 0; //y pos of background 
			var backgroundW  = canvas.width; //width of background 
			var backgroundH  = canvas.height; //height of background 
			
			//basket vars:
			var basketImg = new Image(); //basket image
			var basketW = 100; //width of basket
			var basketH = 100; //height of basket
			var basketX = (canvas.width - basketW) /2; //x pos of basket 
			var basketY = (canvas.height - basketH) - 10; //y pos of basket 
			var Basket = null;  //basket object //+++++++++++++++++++++++++++++++++can maybe go!
			
			//apple vars:
			var appleImg = new Image(); //apple image
			appleImg.src = 'img/apl.png'; //image source
			var MAX_APLS = 2; //////////////10; //amount of apples
			var applesArray = []; //array for apples 
			//var canDrop = [MAX_APLS]; //holds which apples can drop
			var appleX = [50, 100]; //50; //[50, 100, 100, 200, 220, 260, 350, 400, 450, 300]; //holds x pos of apples   // 
			var appleY = [280, 200]; //280; // [280, 200, 100, 20, 150, 60, 120, 140, 240, 20]; //holds y pos of apples  [  
			var appleW = 60; //width of apple
			var appleH = 60; //height of apple
			////////////////////////var Apple = null; //apple object
			
			//var randY = 0; //holds random y pos //+++++++++++++ 
			
			var i = 0; //for loops 
			var hits = 0; //hit counter
            var key = []; //for keycode values   
			
			//game timer: ////////////////////////////CAN PROBABLY BE LOCAL +++++++++++++++++++++
			var time = 0; //time
			var timer = null; //counter
			
			//==========================================
			//var randNum;
			////var test;
			//+++++++++++++++++++
			
			function Apple(xPos, yPos, randNum){
				this.xPos = xPos;
				this.yPos = yPos;
				this.width = appleW;
				this.height = appleH;
				this.speed = randNum;
				this.fall = function(){
						this.yPos += this.speed; //drop apple
				};
			}
			/*
			function AppleObj(xPos, yPos){
				this.xPos = xPos;
				this.yPos = yPos;
				this.width = appleW;
				this.height = appleH;
			}*/
			
			/*
			AppleObj.prototype.waitToFall = function(i){
						console.log("bb");
						
						if (i==0)
						{
							this.yPos += 1;
						}else if (i==1)
						{
							this.yPos += 8;
						}
						else{
							this.yPos += 3;
						}
						//this.yPos += 1;
						//animate();
						//updateApples();
						//testFunct();
						//requestAnimationFrame(AppleObj.prototype.waitToFall);
						//ctx.beginPath();
						
				};*/
			
			//++++++++++++++++++++
			
			//=========================================
			
			//styles for hits:
			document.getElementById("hits").style.fontSize = "x-large"; //font size
			document.getElementById("hits").style.fontFamily = "Comic Sans MS"; //font family
			
			//styles for timer
			document.getElementById("timer").style.fontSize = "x-large"; //font size
			document.getElementById("timer").style.fontFamily = "Comic Sans MS"; //font family
			
			//onload events:
			backgroundImg.onload = function(){
				ctx.drawImage(backgroundImg, backgroundX, backgroundY, backgroundW, backgroundH); //draw background
				
				//basket image source (assigned here so that background is drawn first)
				basketImg.src = 'img/bsk.png'; 
				
				//load and draw basket:
				basketImg.onload = function(){
					ctx.drawImage(basketImg, basketX, basketY, basketW, basketH);    
				}
				
			}
			
			
			//key event listeners:
			window.addEventListener("keydown", function(event){ //listens for key press, adds its keycode 
				key[event.keyCode] = true; 
			});
	   
		    window.addEventListener("keyup", function(event){ //listens for key release, removes its keycode
				key[event.keyCode] = false;
		    });
			
			
			//*********************************GAME IS STARTED HERE************************************
			innit(); //initialise variables
			//playGame(); //play game
			//****************************************************************************************

			//initialise the game:
			function innit(){
				
				//hits = 0; //set hit counter 
				time = 16; //set time
				timer = setInterval(runTimer, 1000); //run timer
				//document.getElementById("hits").innerHTML = hits; //set value of hits 
				//document.getElementById("timer").innerHTML = "Ready!?"; //set start message //++++++++++++++++++++++++++
				document.getElementById("timer").innerHTML = time; // + " secs"; //set start message //++++++++++++++++++++++++++
				////randY = 0; //set y pos*/
				
				//set basket:
				Basket = {
					xPos: basketX,
					yPos: basketY,
					width: basketW,
					height: basketH,
					move: function(){
						if (key[37]){ //if left is pressed
							Basket.xPos -=30; //decrease x pos
							
							if(Basket.xPos <0){ //check for canvas collision
								Basket.xPos = 0; //stop at screen edge
							}
						}else if (key[39]){ //if right is pressed
							Basket.xPos += 30; //increase x pos
					
							if(Basket.xPos > (canvas.width - Basket.width)){ //check for canvas collision
								Basket.xPos = canvas.width - Basket.width; //stop at screen edge
							}
						}
						ctx.drawImage(basketImg, Basket.xPos, Basket.yPos, Basket.width, Basket.height); //draw basket 
					}
				};
				
				var randNum; //holds random number below
				
				//create and store Apples:
				for (i=0; i<MAX_APLS; i++){
				
					randNum = Math.floor(Math.random() * 10) + 1; //make random number between 1 and 10
					console.log(randNum);
					applesArray.push(new Apple(appleX[i], appleY[i], randNum));
				}
				
			
				//each apple has a timer, which is fired upon apple creation
				//when timer is reached, it calls its own drop method, with a random time.
				//drop method checks if apple has hit basket or floor;
				//resets itself if hit either, and starts a new timer
				//=====================================
				
				
				
				//https://stackoverflow.com/questions/30578195/how-to-make-multiple-balls-drop-on-click	+++++++++++++++++++++++++	
				
				animate(); //animate game
			}

			
			function animate(){
			
				ctx.clearRect(0, 0, canvas.width, canvas.height); //clear canvas
				ctx.drawImage(backgroundImg, backgroundX, backgroundY, backgroundW, backgroundH); //draw background
					
				//=============================================
				
				
				for (var i=0, AppleI; AppleI = applesArray[i];i++){
				
					AppleI.fall();
					ctx.drawImage(appleImg, AppleI.xPos, AppleI.yPos, AppleI.width, AppleI.height);
				}
				
					//=============================================
				
				Basket.move(); //moveBasket();
			
				requestAnimationFrame(animate); //game continues
				
			}
			
			//timer
			function runTimer(){
			
				time--; //reduce timer
				
				if (time <=0){ //check if timer ended
					clearInterval(timer); //clear interval
					//gameEnd(); //end game  //+++++++++++++++++++++++++
					//innit(); //+++++++++++++++++++REMOVE LATER!!
					
				}
				
				document.getElementById("timer").innerHTML = time; //update time
			}
			
			
		</script>
		
		
		
  </body>
</html>