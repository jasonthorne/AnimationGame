<!DOCTYPE html>

<html>
  <head>
    <meta charset="UTF-8">
    <title>Apple Catch</title>
    <style type="text/css">
	
		#timerCounterDiv{
			width: auto;
			height: auto;
			position: absolute;
			left: 73px;
			top: 50px;
		}
    
		#hitsCounterDiv {
			width: auto;
			height: auto;
			position: absolute;
			left: 75px; 
			top: 50px; 
		}    
			
		#span{
			position: absolute;
			right: 20px;
			top: 20px;
		}
    
    </style>
  </head>
  <body>
  
		<div id="timerCounterDiv">
           <span id="timer"></span> <!--shows timer-->
        </div>
  
        <div id="hitsCounterDiv">
            <span id="hits"></span> <!--shows hits-->
        </div>
		
		<canvas id="canvas" width="873" height="640"></canvas> 
        <script type="text/javascript">
			
			//create canvas:
			var canvas = document.getElementById("canvas"),
			ctx = canvas.getContext("2d");
			
			//background vars: 
			var backgroundImg = new Image(); //background image
			backgroundImg.src = 'img/bg.png'; //image source
			var backgroundX  = 0; //x pos of background 
			var backgroundY  = 0; //y pos of background 
			var backgroundW  = canvas.width; //width of background 
			var backgroundH  = canvas.height; //height of background 
			
			//basket vars:
			var basketImg = new Image(); //basket image
			var basketW = 100; //width of basket
			var basketH = 100; //height of basket
			var basketX = (canvas.width - basketW) /2; //x pos of basket 
			var basketY = (canvas.height - basketH) - 10; //y pos of basket 
			//var Basket = null;  //basket object //+++++++++++++++++++++++++++++++++can maybe go!
			
			//apple vars:
			var appleImg = new Image(); //apple image
			appleImg.src = 'img/apl.png'; //image source
			var MAX_APLS = 10; //amount of apples
			var applesArray = []; //array for apples 
			//var canDrop = [MAX_APLS]; //holds which apples can drop
			var appleX = [50, 130, 200, 260, 350, 450, 600, 610, 550, 750]; //holds x pos of apples  
			var appleY = [180, 100, 180, 80, 150, 220, 40, 150, 240, 200]; //holds y pos of apples   
			var appleW = 60; //width of apple
			var appleH = 60; //height of apple
			var appleSpeedsArray = [3, 6, 12]; //hold apple drop speeds
			////////////////////////var Apple = null; //apple object
			
			//var randY = 0; //holds random y pos //+++++++++++++ 
			
			var i = 0; //for loops 
			var hits = 0; //hit counter
            var key = []; //for keycode values   
			
			//game timer: ////////////////////////////CAN PROBABLY BE LOCAL +++++++++++++++++++++
			var time = 0; //time
			var timer = null; //counter
			
			//==========================================
			var test;
			//++++++++++++++++++++
			
			var testPic1 = new Image();
			testPic1.src = 'img/apl1.png';
			var testPic2 = new Image();
			testPic2.src = 'img/apl2.png';
			var testPic3 = new Image();
			testPic3.src = 'img/apl3.png';
			var testPic4 = new Image();
			testPic4.src = 'img/apl4.png';
			var testPic5 = new Image();
			testPic5.src = 'img/apl5.png';
			var testPic6 = new Image();
			testPic6.src = 'img/apl6.png';
			var testPic7 = new Image();
			testPic7.src = 'img/apl7.png';
			var testPic8 = new Image();
			testPic8.src = 'img/apl8.png';
			var testPic9 = new Image();
			testPic9.src = 'img/apl9.png';
			var testPic10 = new Image();
			testPic10.src = 'img/apl10.png';
			
			var testPicsArray = [testPic1, testPic2, testPic3, testPic4, testPic5, testPic6, testPic7, testPic8, testPic9, testPic10];
			
			//+++++++++++++++++++
			
			
			//styles for hits:
			document.getElementById("hits").style.fontSize = "x-large"; //font size
			document.getElementById("hits").style.fontFamily = "Comic Sans MS"; //font family
			
			//styles for timer
			document.getElementById("timer").style.fontSize = "x-large"; //font size
			document.getElementById("timer").style.fontFamily = "Comic Sans MS"; //font family
			
			//onload events:
			backgroundImg.onload = function(){
				ctx.drawImage(backgroundImg, backgroundX, backgroundY, backgroundW, backgroundH); //draw background
				
				//basket image source (assigned here so that background is drawn first)
				basketImg.src = 'img/bsk.png'; 
				
				//load and draw basket:
				basketImg.onload = function(){
					ctx.drawImage(basketImg, basketX, basketY, basketW, basketH);    
				}
				
			}
			
			
			//key event listeners:
			window.addEventListener("keydown", function(event){ //listens for key press, adds its keycode 
				key[event.keyCode] = true; 
			});
	   
		    window.addEventListener("keyup", function(event){ //listens for key release, removes its keycode
				key[event.keyCode] = false;
		    });
			
			//=========================================
			//prototype method added to Array class, to allow random picking of elements:
			Array.prototype.pickRandomElement = function(){ 
				return this[Math.floor(Math.random()*this.length)]; //return a random element
			}
			
			//https://stackoverflow.com/questions/4550505/getting-a-random-value-from-a-javascript-array
			
			function Apple(xPos, yPos, i){ ////////////////////////REMOVE THIS LATER!!! ++++++++++++
			//function Apple(xPos, yPos){
				this.name = i; ////////////////////////REMOVE THIS LATER!!! ++++++++++++
				this.xPos = xPos;
				this.yPos = yPos;
				this.width = appleW;
				this.height = appleH;
				this.speed = appleSpeedsArray.pickRandomElement(); //pick a speed for apple to drop by
				this.fall = function(){
					this.yPos += this.speed; //drop apple
					//console.log("Apple: " + this.name + ".Drop speed: " + this.speed); ////REMOVE THIS LATER!!! ++++++++++++
					if(this.yPos >= (canvas.height - this.height)){ //check if apple has hit bottom of canvas
						this.yPos = yPos //reset y position
						this.speed = appleSpeedsArray.pickRandomElement(); //assign a new random speed
					}
					
				};
			}
			
			//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
			
			function Basket(){
					this.xPos = basketX;
					this.yPos = basketY;
					this.width = basketW;
					this.height = basketH;
					this.move = function(){
						if (key[37]){ //if left is pressed
							this.xPos -=30; //decrease x pos
							
							if(this.xPos <0){ //check for canvas collision
								this.xPos = 0; //stop at screen edge
							}
						}else if (key[39]){ //if right is pressed
							this.xPos += 30; //increase x pos
					
							if(this.xPos > (canvas.width - this.width)){ //check for canvas collision
								this.xPos = canvas.width - this.width; //stop at screen edge
							}
						}//else: pause game and remind user of key controls //+++++++++++++++++++++++++++++DONT FORGET THIS!!!! 
						ctx.drawImage(basketImg, this.xPos, this.yPos, this.width, this.height); //draw basket 
					};
			}
			
			
			//=========================================
			
			
			//*********************************GAME IS STARTED HERE************************************
			innit(); //initialise variables
			//playGame(); //play game
			//****************************************************************************************

			//initialise the game:
			function innit(){
				
				//hits = 0; //set hit counter 
				time = 16; //set time
				timer = setInterval(runTimer, 1000); //run timer
				//document.getElementById("hits").innerHTML = hits; //set value of hits 
				//document.getElementById("timer").innerHTML = "Ready!?"; //set start message //++++++++++++++++++++++++++
				document.getElementById("timer").innerHTML = time; // + " secs"; //set start message //++++++++++++++++++++++++++
				////randY = 0; //set y pos*/
				
				/*
				//set basket:
				Basket = {
					xPos: basketX,
					yPos: basketY,
					width: basketW,
					height: basketH,
					move: function(){
						if (key[37]){ //if left is pressed
							Basket.xPos -=30; //decrease x pos
							
							if(Basket.xPos <0){ //check for canvas collision
								Basket.xPos = 0; //stop at screen edge
							}
						}else if (key[39]){ //if right is pressed
							Basket.xPos += 30; //increase x pos
					
							if(Basket.xPos > (canvas.width - Basket.width)){ //check for canvas collision
								Basket.xPos = canvas.width - Basket.width; //stop at screen edge
							}
						}//else: pause game and remind user of key controls //+++++++++++++++++++++++++++++DONT FORGET THIS!!!! 
						ctx.drawImage(basketImg, Basket.xPos, Basket.yPos, Basket.width, Basket.height); //draw basket 
					}
				};
				*/
				test = new Basket();
				
				//create and store Apples:
				for (i=0; i<MAX_APLS; i++){
				
					applesArray.push(new Apple(appleX[i], appleY[i], i+1)); ////REMOVE THIS LATER!!! ++++++++++
					//applesArray.push(new Apple(appleX[i], appleY[i])); //add Apple to array 
				}
				
			
				//each apple has a timer, which is fired upon apple creation
				//when timer is reached, it calls its own drop method, with a random time.
				//drop method checks if apple has hit basket or floor;
				//resets itself if hit either, and starts a new timer
				//=====================================
				
				
				
				//https://stackoverflow.com/questions/30578195/how-to-make-multiple-balls-drop-on-click	+++++++++++++++++++++++++	
				
				animate(); //animate game
			}
			
			
			
		
			function animate(){
			
				ctx.clearRect(0, 0, canvas.width, canvas.height); //clear canvas
				ctx.drawImage(backgroundImg, backgroundX, backgroundY, backgroundW, backgroundH); //draw background
					
				//=============================================
				for (var i=0, AppleI; AppleI=applesArray[i]; i++){ //grab each Apple in array
					AppleI.fall(); //invoke fall
					//ctx.drawImage(appleImg, AppleI.xPos, AppleI.yPos, AppleI.width, AppleI.height); //draw Apple
					ctx.drawImage(testPicsArray[i], AppleI.xPos, AppleI.yPos, AppleI.width, AppleI.height); //draw Apple

					//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
					if(hitApl(applesArray[i], test)){ //check if apple hit basket
						console.log("we got em!");
                    }//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
				}
				
				//=============================================
				
				//Basket.move(); //moveBasket();
				test.move(); //+++++++++++++++++++++++++++++++++++++++++++++++++
			
				requestAnimationFrame(animate); //game continues
				
			}
			
			//timer
			function runTimer(){
			
				time--; //reduce timer
				
				if (time <=0){ //check if timer ended
					clearInterval(timer); //clear interval
					//gameEnd(); //end game  //+++++++++++++++++++++++++
					//innit(); //+++++++++++++++++++REMOVE LATER!!
					
				}
				
				document.getElementById("timer").innerHTML = time; //update time
			}
			
			
			function hitApple(Apple,Basket){
			//console.log(Apple);
			//console.log(Basket);
            //return if apple has hit basket
             return Apple.xPos < Basket.xPos + Basket.width && 
             Apple.xPos + Apple.width > Basket.xPos &&
             Apple.yPos < Basket.yPos + Basket.hight &&
             Apple.yPos + Apple.hight > Basket.yPos;
			}
			
			
			function hitApl(a, b) //checks for collision
			{
            //return if apple has hit basket
             return a.xPos < b.xPos + b.wdth && 
             a.xPos + a.wdth > b.xPos &&
             a.yPos < b.yPos + b.hght &&
             a.yPos + a.hght > b.yPos;
			}
			
		</script>
		
		
		
  </body>
</html>