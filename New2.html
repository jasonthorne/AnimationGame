<!DOCTYPE html>

<html>
  <head>
    <meta charset="UTF-8">
    <title>Apple Catch</title>
    <style type="text/css">
	
		#timerCounterDiv{
			width: auto;
			height: auto;
			position: absolute;
			left: 73px;
			top: 50px;
		}
    
		#hitsCounterDiv {
			width: auto;
			height: auto;
			position: absolute;
			left: 75px; 
			top: 50px; 
		}    
			
		#span{
			position: absolute;
			right: 20px;
			top: 20px;
		}
    
    </style>
  </head>
  <body>
  
		<div id="timerCounterDiv">
           <span id="timer"></span> <!--shows timer-->
        </div>
  
        <div id="hitsCounterDiv">
            <span id="hits"></span> <!--shows hits-->
        </div>
		
		<canvas id="canvas" width="873" height="640"></canvas> 
        <script type="text/javascript">
			
			//create canvas:
			var canvas = document.getElementById("canvas"),
			ctx = canvas.getContext("2d");
			
			//background vars: 
			var backgroundImg = new Image(); //background image
			backgroundImg.src = 'img/bg.png'; //image source
			var backgroundX  = 0 //x pos of background 
			var backgroundY  = 0; //y pos of background 
			var backgroundW  = canvas.width; //width of background 
			var backgroundH  = canvas.height; //height of background 
			
			//basket vars:
			var basketImg = new Image(); //basket image
			var basketW = 100; //width of basket
			var basketH = 100; //height of basket
			var basketX = (canvas.width - basketW) /2; //x pos of basket 
			var basketY = (canvas.height - basketH) - 10; //y pos of basket 
			var basketObj = null;  //basket object //+++++++++++++++++++++++++++++++++can maybe go!
			
			//apple vars:
			var appleImg = new Image(); //apple image
			appleImg.src = 'img/apl.png'; //image source
			var MAX_APLS = 2; //////////////10; //amount of apples
			var applesArray = []; //array for apples 
			//var canDrop = [MAX_APLS]; //holds which apples can drop
			var appleX = [50, 100]; //50; //[50, 100, 100, 200, 220, 260, 350, 400, 450, 300]; //holds x pos of apples   // 
			var appleY = [280, 200]; //280; // [280, 200, 100, 20, 150, 60, 120, 140, 240, 20]; //holds y pos of apples  [  
			var appleW = 60; //width of apple
			var appleH = 60; //height of apple
			////////////////////////var appleObj = null; //apple object
			
			//var randY = 0; //holds random y pos //+++++++++++++ 
			
			var i = 0; //for loops 
			var hits = 0; //hit counter
            var key = []; //for keycode values   
			
			//game timer: ////////////////////////////CAN PROBABLY BE LOCAL +++++++++++++++++++++
			var time = 0; //time
			var timer = null; //counter
			
			//==========================================
			var randNum;
			var test;
			//+++++++++++++++++++
			/*
			function AppleObj(xPos, yPos){
				this.xPos = xPos;
				this.yPos = yPos;
				this.width = appleW;
				this.height = appleH;
			}
			
			AppleObj.prototype.waitToFall = function(){
					console.log("hi");
					this.yPos += 1;
					//animate();
					//updateApples();
					//ctx.drawImage(apple, AppleObj.xPos, AppleObj.yPos, AppleObj.width, AppleObj.height);
					//requestAnimationFrame(AppleObj.prototype.waitToFall);
					//ctx.beginPath();
					
			};*/
			
			
			function AppleObj(xPos, yPos){
				this.xPos = xPos;
				this.yPos = yPos;
				this.width = appleW;
				this.height = appleH;
				this.waitToFall = function(i){
						//ctx.drawImage(apple, this.xPos, this.yPos, this.width, this.height);
						if (i==0)
						{
							this.yPos += 1;
						}else if (i==1)
						{
							this.yPos += 8;
						}
				};
			}
			/*
			function AppleObj(xPos, yPos){
				this.xPos = xPos;
				this.yPos = yPos;
				this.width = appleW;
				this.height = appleH;
			}*/
			
			/*
			AppleObj.prototype.waitToFall = function(i){
						console.log("bb");
						
						if (i==0)
						{
							this.yPos += 1;
						}else if (i==1)
						{
							this.yPos += 8;
						}
						else{
							this.yPos += 3;
						}
						//this.yPos += 1;
						//animate();
						//updateApples();
						//testFunct();
						//requestAnimationFrame(AppleObj.prototype.waitToFall);
						//ctx.beginPath();
						
				};*/
			
			//++++++++++++++++++++
			
			//=========================================
			
			//styles for hits:
			document.getElementById("hits").style.fontSize = "x-large"; //font size
			document.getElementById("hits").style.fontFamily = "Comic Sans MS"; //font family
			
			//styles for timer
			document.getElementById("timer").style.fontSize = "x-large"; //font size
			document.getElementById("timer").style.fontFamily = "Comic Sans MS"; //font family
			
			//onload events:
			backgroundImg.onload = function(){
				ctx.drawImage(backgroundImg, backgroundX, backgroundY, backgroundW, backgroundH); //draw background
				
				//basket image source (assigned here so that background is drawn first)
				basketImg.src = 'img/bsk.png'; 
				
				//load and draw basket:
				basketImg.onload = function(){
					ctx.drawImage(basketImg, basketX, basketY, basketW, basketH);    
				}
				
			}
			
			
			//key event listeners:
			window.addEventListener("keydown", function(event){ //listens for key press, adds its keycode 
				key[event.keyCode] = true; 
			});
	   
		    window.addEventListener("keyup", function(event){ //listens for key release, removes its keycode
				key[event.keyCode] = false;
		    });
			
			
			//*********************************GAME IS STARTED HERE************************************
			innit(); //initialise variables
			//playGame(); //play game
			//****************************************************************************************

			//initialise variables:
			function innit(){
				
				//hits = 0; //set hit counter 
				time = 16; //set time
				timer = setInterval(runTimer, 1000); //run timer
				//document.getElementById("hits").innerHTML = hits; //set value of hits 
				//document.getElementById("timer").innerHTML = "Ready!?"; //set start message //++++++++++++++++++++++++++
				document.getElementById("timer").innerHTML = time; // + " secs"; //set start message //++++++++++++++++++++++++++
				////randY = 0; //set y pos*/
				
				//set basket:
				basketObj = {
					xPos: basketX,
					yPos: basketY,
					width: basketW,
					height: basketH,
					move: function(){
						if (key[37]){ //if left is pressed
							basketObj.xPos -=30; //decrease x pos
							
							if(basketObj.xPos <0){ //check for canvas collision
								basketObj.xPos = 0; //stop at screen edge
							}
						}else if (key[39]){ //if right is pressed
							basketObj.xPos += 30; //increase x pos
					
							if(basketObj.xPos > (canvas.width - basketObj.width)){ //check for canvas collision
								basketObj.xPos = canvas.width - basketObj.width; //stop at screen edge
							}
						}
						ctx.drawImage(basketImg, basketObj.xPos, basketObj.yPos, basketObj.width, basketObj.height); //draw basket 
					}
				};
				
				
				//=====================================
				
				/*0000000000000000000000
				function AppleObj(xPos, yPos){
				this.xPos = xPos;
				this.yPos = yPos;
				this.width = appleW;
				this.height = appleH;
				}
			
				
				AppleObj.prototype.waitToFall = function(){
						console.log("hi");
						this.yPos += 1;
						//animate();
						//updateApples();
						//testFunct();
						//requestAnimationFrame(AppleObj.prototype.waitToFall);
						//ctx.beginPath();
						
				};
				*/000000000000000000
				
				
				for (i=0; i<MAX_APLS; i++){
					//test = new AppleObj(appleX[i], appleY[i]);
					//test.waitToFall();
					//console.log(test.yPos);
					//applesArray.push(test);
					applesArray.push(new AppleObj(appleX[i], appleY[i]));
					//console.log(applesArray[i]);
				}
				
				/* 88888888888888888888888888888888
				(function testFunct(){
				
					for (i=0; i<MAX_APLS; i++){
						test = applesArray[i];
						test.waitToFall();
					}
					
				
					requestAnimationFrame(testFunct);
				})();*/
				
				
				/*88888888888888888888888888888888888
				for (i=0; i<MAX_APLS; i++){
					test = applesArray[i];
					
					
					test.waitToFall();
					
					console.log(applesArray[i]);
					console.log("Yo");
				}*/
				
				//ctx.drawImage(apple, test.xPos, test.yPos, test.width, test.height);
				/*
				for (var i = 0, apl; apl = applesArray[i]; i++){
					console.log("erer")
					apl.waitToFall();
				}*/
				

			
				//each apple has a timer, which is fired upon apple creation
				//when timer is reached, it calls its own drop method, with a random time.
				//drop method checks if apple has hit basket or floor;
				//resets itself if hit either, and starts a new timer
				//=====================================
				
				
				
				//https://stackoverflow.com/questions/30578195/how-to-make-multiple-balls-drop-on-click	+++++++++++++++++++++++++	
				
				animate(); //animate game
			}

			
			function animate(){
			
				ctx.clearRect(0, 0, canvas.width, canvas.height); //clear canvas
				ctx.drawImage(backgroundImg, backgroundX, backgroundY, backgroundW, backgroundH); //draw background
					
				//=============================================
				
				//for (i=0; i<MAX_APLS; i++){
				for (var i = 0, Appl; Appl = applesArray[i]; i++){
					//console.log(applesArray[i]);
					//test = applesArray[i];
					//test.waitToFall(i);
					Appl.waitToFall(i);
					////////////applesArray[i].waitToFall(i);
					//ctx.drawImage(apple, test.xPos, test.yPos, test.width, test.height);
					ctx.drawImage(appleImg, Appl.xPos, Appl.yPos, Appl.width, Appl.height);
					/////////ctx.drawImage(apple, applesArray[i].xPos, applesArray[i].yPos, applesArray[i].width, applesArray[i].height);
					
				}
				
				/*
				(function testFunct(){
				
					for (i=0; i<MAX_APLS; i++){
						test = applesArray[i];
						test.waitToFall();
					}
					
				
					requestAnimationFrame(testFunct);
				})();*/
				
				//ctx.drawImage(apple, AppleObj.xPos, AppleObj.yPos, AppleObj.width, AppleObj.height); 
				//ctx.drawImage(apple, test.xPos, test.yPos, test.width, test.height);
				//appleObj.waitToFall();
				//=============================================
				
				basketObj.move(); //moveBasket();
			
				requestAnimationFrame(animate); //game continues
				
			}
			
			//timer
			function runTimer(){
			
				time--; //reduce timer
				
				if (time <=0){ //check if timer ended
					clearInterval(timer); //clear interval
					//gameEnd(); //end game  //+++++++++++++++++++++++++
					//innit(); //+++++++++++++++++++REMOVE LATER!!
					
				}
				
				document.getElementById("timer").innerHTML = time; //update time
			}
			
			
		</script>
		
		
		
  </body>
</html>