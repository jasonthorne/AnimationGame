<!DOCTYPE html>

<html>

  <head>
    <meta charset="UTF-8">
    <title>Apple Catch</title>

    <style type="text/css">
    </style>

  </head>

  <body>

    <canvas id="canvas" width="550" height="650"></canvas>
    <script type="text/javascript">
           
        var canvas = document.getElementById("canvas"),
        ctx = canvas.getContext("2d");
       
        

        //background variables 
        var bg = new Image(); //background image
        bg.src = 'img/bg.png'; //source for background image.
        var bgX  = 0 //x pos of background 
        var bgY  = 0; //y pos of background 
        var bgW  = canvas.width; //width of background 
        var bgH  = canvas.height; //height of background  


        //apple variables
        var apl = new Image(); //apple image
        apl.src = 'img/apl.png'; /////////////////////////////////MAYBE DELETE (if showing apples onload)
        var apls = new Array(); //array for apples
        var MAX_APLS = 10; //ammount of apples
        var aplW = 60; //width of apple
        var aplH = 60; //height of apple
        var aplX = [30, 100, 150, 200, 250, 300, 350, 400, 450, 180]; //holds x pos of apples    //////////////////////////////////////ARRANGE THESE BETTER!!! 
        var aplY = [60, 40, 30, 20, 80, 20, 70, 40, 60, 100]; //holds y pos of apples       //////////////////////////////////////ARRANGE THESE BETTER!!! 
        var canDrop = [false, false, false, false, false, false, false, false, false, false]; //holds which apples can drop
        var randY = 0; //holds random y pos
        
        
        //basket variables
        var bsk = new Image(); //basket image
        var bskW = 100; //width of basket
        var bskH = 100; //height of basket
        var bskX = (canvas.width - bskW) /2; //x pos of basket
        var bskY = (canvas.height - bskH) - 10; //y pos of basket
        
        //basket object
        var bskObj =
        {
                 xPos: bskX,
                 yPos: bskY,
                 wdth: bskW,
                 hght: bskH       
        };

        //other variables
        var i = 0; //for loops 
        var hits = 0; //hit counter
      
    
    
        

        //onload events. loads and draw tree image, then basket
        bg.onload = function()
        {
            ctx.drawImage(bg, bgX, bgY, bgW, bgH); 
           /*apl.src = 'img/apl.png'; /////////////////////////////////////DELETE++++++++++++++++++++++
            apl.onload = function() ///////////////////////DELETE. no initial draw, so that apple location is hidden b4 drop+++++++++++++++
            {
                         for (i=0; i<MAX_APLS; i++) ///////////////Incase we want an initial draw! can use to layout apples
                         {
                             
                              ctx.drawImage(apl, aplX[i], aplY[i], aplW, aplH);////////////////////////++++++++++++++++++DELETE(maybe!)
                         }
            }*/
            
            bsk.src = 'img/bsk.png';
            bsk.onload = function()
            {
                ctx.drawImage(bsk, bskObj.xPos, bskObj.yPos, bskObj.wdth, bskObj.hght);
            }
            
        }
    
        
        
        /*/////////////////////////////////WORKS. JUST TRYING THE OTHER FOR X AND Y USE
       var apls = new Array();

        function innitApls()
        {
            for (i=0; i<maxApls; i++)
            {
                apls[i] = new Image();
                apls[i].src = 'img/apl.png';
                ctx.drawImage(apls[i], aplX, aplY, aplW, aplH); //draw apple //+++++++++++++++++++++DELETE!!

                 //console.log("apple number" + " " + i + " " + "made"); //+++++++++++++++++++++DELETE!!
            }


        }*/



          ////////////////////////// loop();
  
        
        //---------------------------MAKE APPLE ARRAY-------------------------------------
        function makeApls()
        {
            for (i=0; i<MAX_APLS; i++)
            {
                apls[i] = 
                {

                    xPos: aplX[i],
                    yPos: aplY[i],
                    wdth: aplW,
                    hght: aplH  

                }; 

               ////////////////console.log(apls[i], apls[i].xPos, apls[i].yPos, aplW, aplH); //++++++++++++++++++++++++++DELETE
               //ctx.drawImage(apl, apls[i].xPos, apls[i].yPos, aplW, aplH);////////////////////////++++++++++++++++++DELETE(maybe!)
            }
            
         
        }
        

    
        //==========================================
        //--------------------------------------------------------------------


        window.addEventListener("keydown", function(event) 
        { 
                ctx.clearRect(0, 0, canvas.width, canvas.height);


                if (event.keyCode == 37) //if left is pressed
                {
                  bskObj.xPos -= 20;
                    
                    if(bskObj.xPos < (canvas.width - (bskW /2)))
                    {
                        ////////////////////////////////////console.log("too far left");
                    }
                }
                else if (event.keyCode == 39) //if right is pressed
                {
                  bskObj.xPos += 20;
                }
            
              /*  if (bskX > (canvas.width - bskW))
                {
                    bskX -= 5; //(canvas.width - bskW);
                    console.log("too far this way");
                }
                                
                else if (bskX < (canvas.width - bskW))
                {
                    bskX += 5; //(canvas.width - bskW);
                    console.log("too far that way!!");
                }*/
        
            /*
                if(apls[i].yPos >= (canvas.height - aplH)) //detect if apple has hit bottom of canvas
                    {
                        
                        apls[i].yPos = aplY[i] //reset position if so
                        canDrop[i] = false; //return to wait
*/
                draw();

        });

    //--------------------------------------------------------------------

        makeApls(); //////////////////////Probably doesnt need to be in a function!!
        //dropApl();
        //pickApl();
       repeatMe();///////////////////////


        function repeatMe() 
        {

            
           waitToPick();
            ///////////pickApl();  
            
            //////////console.log("in repeatMe"); //+++++++++++++++++++++++++++++++++++++++++++++++++++

            ctx.clearRect(0, 0, canvas.width, canvas.height);   

            dropApl();
            
            /*for(i=0; i<MAX_APLS; i++)
            {
                
                
                if(canDrop[i] == true)
                {
                   //////////////////////////apls[i].yPos +=5;
                    
                    apls[i].yPos += randY;
                    
                    
                        
                    if(apls[i].yPos >= (canvas.height - aplH)) //detect if apple has hit bottom of canvas
                    {
                        
                        apls[i].yPos = aplY[i] //reset position if so
                        canDrop[i] = false; //return to wait
                       
                    }
                }
                
                /////////////ctx.drawImage(apl, apls[i].xPos, apls[i].yPos, aplW, aplH);
            }*/
            

            ////////////console.log("aplY is: " + aplY); //+++++++++++++++++++++++++++++++++++++++++++++++++++
            draw();
            
            


                window.requestAnimationFrame(repeatMe);
    


         }


     //--------------------------------------------------------------------


        function draw()
        {

           ///////////////console.log("draw has been called"); //+++++++++++++++++++++++++++++++++++++++++++++++++++
          
           ctx.drawImage(bg, bgX, bgY, bgW, bgH); //draw background 
          
           for(i=0; i<MAX_APLS; i++) //draw apples
            {
                
                ctx.drawImage(apl, apls[i].xPos, apls[i].yPos, apls[i].wdth, apls[i].hght);
            }
            
            
            ctx.drawImage(bsk, bskObj.xPos, bskObj.yPos, bskObj.wdth, bskObj.hght); //draw basket 
            
          
        }    

        
        
      //--------------------------------------------------------------------
        
        function dropApl()
        {
            
            for(i=0; i<MAX_APLS; i++) 
            {
                
                if(canDrop[i] == true) //check if apple can be dropped
                {
                   //////////////////////////apls[i].yPos +=5;
                    
                    apls[i].yPos += randY; //drop by randomised ammount
                    
                    
                    /*if(apls[i].yPos == bskObj.xPos) //check if apple has hit basket
                    {
                       console.log("Hit basket!!"); /////////////////////////////////////////////////
                       apls[i].yPos = aplY[i] //reset position if so
                       canDrop[i] = false; //return to wait
                        
                    }*/
                    
                    
                    //===============================================================
                    ///////console.log("Hit basket!!");////////////////
                    
                    if(hitApl(apls[i], bskObj)) //check if apple hit basket
                    {
                        console.log("Hit basket!!"); /////////////////////////////////////////////////DELETE!!
                        hits++; //add to hit count
                        apls[i].yPos = aplY[i] //reset position if so
                        canDrop[i] = false; //return to wait
                    }
                    
                    
                    
                    //===============================================================
                        
                    if(apls[i].yPos >= (canvas.height - aplH)) //check if apple has hit bottom of canvas
                    {
                        
                        apls[i].yPos = aplY[i] //reset position if so
                        canDrop[i] = false; //return to wait
                       
                    }
                }
                
                /////////////ctx.drawImage(apl, apls[i].xPos, apls[i].yPos, aplW, aplH);
            }   
            
        }
        
        

      //---------------------------------------------------------------------- 
        
        function pickApl()
        {
            
            var randApl = Math.floor(Math.random() * ((10 - 0) + 1)) + 0; //pick a random apple to drop
            randY = Math.floor(Math.random() * ((10 - 4) + 1)) + 4; //pick a random y pos to drop by
            
            for(i=0; i<MAX_APLS; i++)
            {
                
                if (randApl == i)
                {
                    canDrop[i] = true;
                     //////////  console.log("i is: " + i); ////////////////////////////////////////////
                      ///////////console.log(canDrop[i]); ////////////////////////////////////////////
                }
                
                 ////////////////// console.log(canDrop); ////////////////////////////////////////////
                ////////ctx.drawImage(apl, apls[i].xPos, apls[i].yPos, aplW, aplH);
            }
            
            ///////////draw();///////////++++++++++++++++
            
        }
        
        
        
      //-----------------------------------------------------


        function waitToPick()
        {
            var randNum = Math.round(Math.random() * (1000 - 4000)); //+ 5000; //between 3 - 5 seconds
            
             setTimeout(function()
             {
                    pickApl();          

             },randNum);
            
        }
        
        
        
        function hitApl(a, b) 
        {
             return a.xPos < b.xPos + b.wdth &&
             a.xPos + a.wdth > b.xPos &&
             a.yPos < b.yPos + b.hght &&
             a.yPos + a.hght > b.yPos;
        }
        


        /*
        LINKS ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++//////////////////////////////////////////////////////
        
        http://stackoverflow.com/questions/17883692/how-to-set-time-delay-in-javascript
        */
       
    

    </script>

  </body>

</html>